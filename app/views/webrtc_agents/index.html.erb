<div class="container">
  <div class="row">
    <div class="col-md-4">
      <p>    
        <button type="button" class="btn btn-primary" onclick="window.location.href='/createacl'">Create ACL</button>
        <button type="button" class="btn btn-primary" onclick="window.location.href='/createipcl'">Create IPACL</button>
        <%= @domain%>
      </p>
    </div>
    <div class="col-md-4">
      <div class="well well-lg">
        <div class="btn-group" role="group" aria-label="...">
          <button type="button" class="btn btn-success" onclick="accept();">
            Accept
          </button>
          <button type="button" class="btn btn-danger" onclick="hangup();">
            Hangup
          </button>
          <button id="mute-btn" type="button" class="btn btn-default" onclick="mute();">
            Mute
          </button>
        </div>
        <div class="panel-body" id="log" >Connecting to Twilio...</div>
      </div>
    </div>
    <div class="col-md-4">
      <p><%= @number%></p>
    </div>
  </div>
</div>

<script type="text/javascript"
  src="//static.twilio.com/libs/twiliojs/1.2/twilio.min.js">
</script>


<script type="text/javascript">

/* Create the Client with a Capability Token */

$( document ).ready(function() {
    Twilio.Device.setup("<%= @token %>", {debug: true});
  });

  /* Let us know when the client is ready. */
  Twilio.Device.ready(function (device) {
    $("#log").text("Client is ready ");
  });
 
  /* Report any errors on the screen */
  Twilio.Device.error(function (error) {
    $("#log").text("Error: " + error.message);
  });
 
  Twilio.Device.connect(function (conn) {
    $("#log").text("SID:  " +  conn.parameters.CallSid);
  });
  
  Twilio.Device.disconnect(function (conn) {
    $("#log").text("Call ended");
  });

  Twilio.Device.incoming(function (conn) {
    $("#log").text("Incoming connection from " + conn.parameters.From);
  });

  function hangup() {
    Twilio.Device.disconnectAll();
  }

  function accept() {
    Twilio.Device.activeConnection().accept();
    $("#log").text("Connection active");
  }
//TODO implement mute
  // function mute() {
  //   if (Twilio.Device.activeConnection().isMuted() == false) {
  //   Twilio.Device.activeConnection().mute(true);
  // }
  //   else { if (Twilio.Device.activeConnection().isMuted() == true)
  //     Twilio.Device.activeConnection().mute(false);
  //   else alert("hi");}
  // }

  </script>